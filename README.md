# Documentation for cMoflon (UNDER CONSTRUCTION)
Documentation for cMoflon, the eMoflon variant for generating Contiki code
----
## How to set up a small case study (walkthrough)

### Prerequisites:
To use CMoflon you will need Eclipse with Modeling Components as well as Enterprise Architect. Eclipse is freely available from https://eclipse.org/downloads/. You can install a trial version of Enterprise Architect from here: https://www.sparxsystems.de/uml/download-trial/

### How to install cMoflon and specify a sample TC algorithm/test the existing TC algorithms
1. This version of CMoflon has been tested with Eclipse Neon.1a Release (4.6.1) and EMoflon 2.24.0 (RC) and Enterprise Architect
1. To install EMoflon use the following update site: https://emoflon.github.io/eclipse-plugin/emoflon_2.24.0/update-site2/
1. You will also need to install a Plug-In for Enterprise Architect from here: https://emoflon.github.io/eclipse-plugin/emoflon_2.24.0/update-site2/ea-ecore-addin.zip
1. Install the CMoflon Plugin (currently not supported via update-site)
1. Start Eclipse and navigate to File->New->Other->eMoflon and select New CMoflon Metamodel Wizard add a name and finish
1. This will create a new project, a socalled metamodel project. Open it and doubleclick the *.eap file
1. Specify your TC algorithm or algorithms according to the preimplemented ones.
1. Hit the validate button and select your project in eclipse and refresh it. This will create two new projects, named after the according ECore Package in Enterprise Architect
1. Inside the project ending with _C there are two *.properties files. Fill those according to the instructions
1. Select the _C project and hit the blue build button, the generated code is placed in the /gen Folder.
### How to get Contiki and the evaluation framework
1. Go to https://sourceforge.net/projects/contiki/files/Instant%20Contiki/Instant%20Contiki%203.0/InstantContiki3.0.zip/download and download the Instant Contiki 3.0 VM 
1. Go to https://git.tk.informatik.tu-darmstadt.de/michael.stein/topology-control-evaluation and clone the evaluation framework.
### How to test a TC algorithm generated by cMoflon in Cooja Simulator
1. Store the src folder of the evaluation framework on a portable drive to be able to access it from the VM later.
1. Copy both generated files into TCEval/src/components/topologycontrol
1. Add the .c File to TCEval/src/components/topologycontrol/Makefile
1. Add the new constant (found in the.c file in the PROCESS section) to TCEval/src/app-conf-constants
1. Copy TCEval/src/app-conf-default, remove the default and change to your wishes
1. Copy TCEval/src/Makefile-conf-default.include remove the default, link to the contiki path in the vm, and do not use IPv6
1. Alternatively you can use the files provided inside the /resources folder.
1. Start the VM, and mount the portable drive.
1. Open a terminal and navigate to /contiki/tools/cooja and use the command ant run to start the Cooja Simulator.
1. Hit CTRL+N to create a new simulation
1. Navigate to Motes->Add motes->Create New Mote Type -> Sky mote and browse to TCEval/src/app.c and hit compile.
1. After compiling is done Create the Motes and run the simulation
### How to test a TC algorithm generated by cMoflon using FlockLab
1. You will need a Flocklab account for testing so create one.
1. Follow the Steps for Cooja until the last, then unmount the drive from the VM
1. Go to the test image section and upload the compiled app.sky file found in TCEval/src
1. Copy the ImageID into the xml configuration provided in the /resources Folder in the Eclipse Project and then upload it to the test section
1. After the Test is run you will get an email with the results in a zip folder.
### How to use the evaluation tools